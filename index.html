<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQ Arena - Puzzle</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root { --blue: #0ea5e9; --gold: #ffbd39; --bg: #0f172a; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; font-family: 'Cairo', sans-serif; background: var(--bg); color: white; overflow: hidden; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .active { display: flex; }
        .logo { font-size: 4.5rem; color: var(--gold); font-weight: 900; margin-bottom: 20px; text-shadow: 0 0 20px rgba(255,189,57,0.4); }
        
        .hex-3d { width: 120px; height: 120px; background: rgba(14,165,233,0.1); border: 2px solid var(--blue); clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); display: flex; align-items: center; justify-content: center; font-size: 3rem; animation: rotateY 6s infinite linear; margin-bottom: 50px; }
        @keyframes rotateY { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }

        /* Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª */
        .levels-grid { display: grid; grid-template-columns: repeat(4, 70px); gap: 20px; padding: 20px; }
        .lvl-node { width: 70px; height: 70px; border-radius: 50%; background: #1e293b; border: 3px solid #334155; display: flex; align-items: center; justify-content: center; font-weight: 900; cursor: not-allowed; opacity: 0.5; }
        .lvl-unlocked { border-color: var(--blue); color: white; cursor: pointer; opacity: 1; box-shadow: 0 0 15px rgba(14,165,233,0.3); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        .puzzle-grid { display: grid; grid-template-columns: repeat(4, 75px); gap: 5px; background: rgba(255,255,255,0.03); padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .tile { width: 75px; height: 75px; cursor: pointer; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .tile svg { width: 100%; height: 100%; stroke: #94a3b8; stroke-width: 6; fill: none; stroke-linecap: round; }
        .tile.connected svg { stroke: var(--blue); filter: drop-shadow(0 0 8px var(--blue)); }

        .btn { background: #ef4444; color: white; border: none; padding: 15px 60px; border-radius: 50px; font-size: 1.3rem; font-weight: 900; cursor: pointer; }
    </style>
</head>
<body>

    <div id="scr-start" class="screen active">
        <div class="logo">IQ Arena</div>
        <div class="hex-3d">ğŸ§ </div>
        <button class="btn" onclick="showMap()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
    </div>

    <div id="scr-map" class="screen">
        <h2 style="color: var(--blue)">Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</h2>
        <div id="map-cont" class="levels-grid"></div>
        <button onclick="switchScreen('scr-start')" style="margin-top:30px; background:none; color:gray; border:none; cursor:pointer;">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="scr-game" class="screen">
        <div id="lvl-title" style="margin-bottom:20px; font-size:1.5rem;">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1</div>
        <div id="game-grid" class="puzzle-grid"></div>
        <button onclick="showMap()" style="margin-top:30px; background:none; border:1px solid #334155; color:white; padding:10px 30px; border-radius:10px; cursor:pointer;">Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
    </div>

    <script>
        let unlockedLevels = parseInt(localStorage.getItem('iq_unlocked')) || 1;
        let currentLvl = 1;
        let gridData = [];

        // ØªØ¹Ø±ÙŠÙ Ø£Ø´ÙƒØ§Ù„ Ø§Ù„Ù‚Ø·Ø¹ (Ø§ØªØµØ§Ù„Ø§Øª: [Ø£Ø¹Ù„Ù‰ØŒ ÙŠÙ…ÙŠÙ†ØŒ Ø£Ø³ÙÙ„ØŒ ÙŠØ³Ø§Ø±])
        const shapes = [
            { id: 'L', path: 'M37.5 0 V37.5 H75', connections: [1, 1, 0, 0] }, // Ø²Ø§ÙˆÙŠØ©
            { id: 'I', path: 'M37.5 0 V75', connections: [1, 0, 1, 0] },     // Ø®Ø· Ù…Ø³ØªÙ‚ÙŠÙ…
            { id: 'T', path: 'M0 37.5 H75 M37.5 37.5 V75', connections: [0, 1, 1, 1] } // Ø­Ø±Ù T
        ];

        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function showMap() {
            const cont = document.getElementById('map-cont');
            cont.innerHTML = '';
            for(let i=1; i<=12; i++) {
                const node = document.createElement('div');
                node.className = `lvl-node ${i <= unlockedLevels ? 'lvl-unlocked' : ''}`;
                node.innerText = i;
                if(i <= unlockedLevels) node.onclick = () => startLevel(i);
                cont.appendChild(node);
            }
            switchScreen('scr-map');
        }

        function startLevel(n) {
            currentLvl = n;
            document.getElementById('lvl-title').innerText = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${n}`;
            generatePuzzle();
            switchScreen('scr-game');
        }

        function generatePuzzle() {
            const grid = document.getElementById('game-grid');
            grid.innerHTML = '';
            gridData = [];
            
            for(let i=0; i<16; i++) {
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                const rot = Math.floor(Math.random() * 4) * 90;
                gridData.push({ ...shape, rotation: rot });

                const div = document.createElement('div');
                div.className = 'tile';
                div.innerHTML = `<svg viewBox="0 0 75 75"><path d="${shape.path}"/></svg>`;
                div.style.transform = `rotate(${rot}deg)`;
                
                div.onclick = function() {
                    gridData[i].rotation = (gridData[i].rotation + 90) % 360;
                    this.style.transform = `rotate(${gridData[i].rotation}deg)`;
                    checkSolution();
                };
                grid.appendChild(div);
            }
            checkSolution();
        }

        function checkSolution() {
            // Ù…Ù†Ø·Ù‚ Ù…Ø¨Ø³Ø· Ù„Ù„ØªØ­Ù‚Ù‚: ÙÙŠ Ù„Ø¹Ø¨Ø© Infinity LoopØŒ Ø§Ù„Ø­Ù„ ÙŠØ¹Ù†ÙŠ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø£Ø·Ø±Ø§Ù Ù…ÙØªÙˆØ­Ø© ØªÙˆØ§Ø¬Ù‡ Ø§Ù„ÙØ±Ø§Øº
            // Ù‡Ù†Ø§ Ø³Ù†Ø­Ø§ÙƒÙŠ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¹Ù†Ø¯ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù‚Ø·Ø¹ (Ù„Ù„ØªØ·ÙˆÙŠØ±: Ù†Ø­ØªØ§Ø¬ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø·Ø±Ø§Ù)
            // Ø³Ø£Ø¬Ø¹Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© "ØªÙ„Ù…Ø¹" Ø§Ù„Ù‚Ø·Ø¹ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ÙƒØ¬Ù…Ø§Ù„ÙŠØ©
            const tiles = document.querySelectorAll('.tile');
            tiles.forEach(t => t.classList.add('connected'));
            
            // Ø´Ø±Ø· Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ÙÙˆØ² (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù„ÙŠÙƒÙˆÙ† Ø£ÙƒØ«Ø± ØµØ±Ø§Ù…Ø©)
            // Ø¥Ø°Ø§ Ø¶ØºØ· Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆØ­Ø±Ùƒ ÙƒÙ„ Ø§Ù„Ù‚Ø·Ø¹ØŒ Ø³Ù†Ø¹ØªØ¨Ø±Ù‡ Ø°ÙƒØ§Ø¡Ù‹ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ù…Ø¤Ù‚ØªØ§Ù‹
            // Ø³Ù†Ø¶ÙŠÙ Ø²Ø± "ØªØ­Ù‚Ù‚" Ø£Ùˆ ÙØ­Øµ Ø¢Ù„ÙŠ Ù‡Ù†Ø§
        }

        function levelComplete() {
            if(currentLvl === unlockedLevels) {
                unlockedLevels++;
                localStorage.setItem('iq_unlocked', unlockedLevels);
            }
            alert("Ø£Ø­Ø³Ù†Øª! ØªÙ… Ø­Ù„ Ø§Ù„Ù„ØºØ².");
            showMap();
        }
    </script>
</body>
</html>
